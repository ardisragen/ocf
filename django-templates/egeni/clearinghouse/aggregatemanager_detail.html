{% extends "clearinghouse/base.html" %}

{% block content %}
<div class="main">
	<div class="details">
	    <h1>Aggregate Manager {{ am.name }}</h1>
	    <p>managed by {{ am.owner.username }}</p>
	    <form method="post" action="">
	    	<table class="aggmgr_form">
	        {{ form.as_table }}
	        </table>
            <input type="submit" value="Save Changes">
        </form>
        <p><a href="{% url aggmgr_delete am.id %}">Delete</a></p>
	</div>
	
	{% if error_message %}
	<div class="error">
	<p><strong>{{ error_message }}</strong></p>
	</div>
	{% endif %}
	
	<div class="nodes">
	    <h2>Nodes:</h2>
        <ol id="nodes">
            {% for node in am.local_node_set.all %}
            <li>Node <a name="{{ node.nodeId }}">{{ node.name }}</a> 
                <ol id="{{ nodeId }}_ifaces">
                    {% for iface in node.interface_set.all %}
                    <li>port {{ iface.portNum }}
                        {% if iface.remoteIfaces.count %}
                        connected to
                        <ol>
                            {% for remoteiface in iface.remoteIfaces.all %}
                            <li>port {{ remoteiface.portNum }} of node 
                                <a href="#{{ remoteiface.ownerNode.nodeId }}">
                                    {{ remoteiface.ownerNode.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ol>
                        {% else %}
                        unconnected.
                        {% endif %}
                    </li>
                    {% endfor %}
                </ol>
            </li>
            {% endfor %}
        </ol>
	</div>
</div>
{% endblock %}