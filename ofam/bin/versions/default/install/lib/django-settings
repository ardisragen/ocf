#!/bin/bash

#Constants
EDITORS="vi vim emacs nano pico"

#Copy from template
printHeader ">" "Copying django settings file from template..."

# Localsettings file will always exist, because the installation process (prior to this step) COPIES that file in the place
if [ -f $SRC_DIR/src/src/foam/ofeliasettings/localsettings-example ] && [ -f $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py ]; then
	# So we check the difference between the tracked and the untracked file.
	# Since the file should be changed, a difference should also exist; therefore the file 'already existed'
	difference=$(diff $SRC_DIR/src/src/foam/ofeliasettings/localsettings-example  $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py)
	if [ "$difference" != "" ]; then
		warning "Localsettings file already exists."
		if [ "$FORCE" == "1" ]; then
			confirm "Overwrite currently installed localsettings.py." $DONT_ABORT
			if [ $? == 0 ]; then			
				cp $SRC_DIR/src/src/foam/ofeliasettings/localsettings-example $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py || error "Cannot copy localsettings.py"
			fi 
		else
			print "Skipping copy (will not be overwritten)"
		fi
	else
		print "$SRC_DIR/src/src/foam/ofeliasettings/localsettings-example -> $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py "
		cp $SRC_DIR/src/src/foam/ofeliasettings/localsettings-example $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py || error "Cannot copy localsettings.py"
	fi
fi

#Choose editor
printHeader ">" "Choosing the editor..."
select editor in $EDITORS;
do
	if [ -z $editor ]; then
		print "Invalid option $editor"
		continue
	fi
	print ""
	EDITOR=$editor
	print "Your are going to use $EDITOR for file manipulation..."
	break;
done

#Edit file
printHeader ">" "Editing localsettings file..."
while :	
do
	print "Now you are going to edit the file $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py using $EDITOR. Save the modifications and do NOT exit using Ctrl+C..."
	pause ""
	eval $EDITOR $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py 
	print ""
	pause "Now the contents of the file will be shown for a final review. You can scroll up/down to verify the settings. Press 'q' to continue..."
	less $SRC_DIR/local/lib/foam/ofeliasettings/localsettings.py
	
	confirm "Everything is OK." $DONT_ABORT $NO_RESCUE

	if [ $? == 0 ]; then
		break
	fi	
done

